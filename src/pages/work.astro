---
import TopNav from "../components/TopNav.astro";
import Footer from "../components/Footer.astro";

// Load case studies
const caseStudyModules = import.meta.glob('../content/case-studies/*.mdx');
const allCaseStudies = await Promise.all(
  Object.entries(caseStudyModules).map(async ([path, module]) => {
    try {
      const caseStudy = await module();
      const filename = path.split('/').pop() || '';
      const slug = filename.replace(/\.mdx$/, '');
      return {
        slug,
        title: caseStudy.frontmatter?.title || 'Untitled',
        lede: caseStudy.frontmatter?.lede || '',
        meta: caseStudy.frontmatter?.meta || [],
        company: caseStudy.frontmatter?.company || caseStudy.frontmatter?.meta?.[0] || ''
      };
    } catch (error) {
      console.error(`Error loading case study from ${path}:`, error);
      return null;
    }
  })
);

// Filter out nulls and templates, and manually define projects for work page
const caseStudies = allCaseStudies.filter(cs => cs !== null && cs.slug !== 'case-study-template' && (cs.slug === 'iherb-desktop-redesign' || cs.slug === 'ai-toolkit' || cs.slug === 'momentum-report' || cs.slug === 'power-lunch'));

// Define project cards with tags - matching joshlee.design style
const projectCards = [
  {
    slug: 'iherb-desktop-redesign',
    company: 'iHerb',
    title: 'Desktop Homepage Redesign',
    description: 'Reframing a high-pressure, executive-driven request into a future-facing design vision that aligned teams and created momentum.',
    tags: ['E-commerce', 'Design Leadership', 'Product Strategy'],
    ...caseStudies.find(cs => cs.slug === 'iherb-desktop-redesign')
  },
  {
    slug: 'ai-toolkit',
    company: 'KPMG Ignition',
    title: 'Enterprise AI Toolkit',
    description: 'A modular, HAX-inspired framework to help product, design, and engineering teams plan and build AI-powered enterprise software.',
    tags: ['AI/ML', 'Design Systems', 'Workshop Facilitation'],
    ...caseStudies.find(cs => cs.slug === 'ai-toolkit')
  },
  {
    slug: 'momentum-report',
    company: 'KPMG Ignition',
    title: 'Momentum Report',
    description: 'Transforming a manual reporting practice into a digital-first insights product inside One Port.',
    tags: ['Product Design', 'Workflow Design', 'Player/Coach'],
    ...caseStudies.find(cs => cs.slug === 'momentum-report')
  },
  {
    slug: 'power-lunch',
    company: 'Solo Project',
    title: 'Power Lunch',
    description: 'Building the MVP product vision for a niche professional network connecting young people to mentors in the sports industry.',
    tags: ['Product Design', 'Founder Partner', 'Full-Stack'],
    ...caseStudies.find(cs => cs.slug === 'power-lunch')
  }
].filter(p => p.slug);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="generator" content={Astro.generator} />
    <title>Work - Billy Carlson</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital@1&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/styles/case-study.css" />
  </head>
  <body>
    <TopNav />
    
    <main class="work-page">
      <div class="work-grid">
        {projectCards.map((project) => (
          <a href={`/case-studies/${project.slug}`} class="project-card">
            <div class="project-card-image">
              <div class="placeholder-image"></div>
            </div>
            <div class="project-card-content">
              <div class="project-card-company">{project.company}</div>
              <h2 class="project-card-title">{project.title}</h2>
              <p class="project-card-description">{project.description}</p>
              <div class="project-card-tags">
                {project.tags.map((tag) => (
                  <span class="project-tag">{tag}</span>
                ))}
              </div>
            </div>
          </a>
        ))}
      </div>
    </main>

    <Footer />
  </body>
</html>

<style>
  .work-page {
    max-width: 1400px;
    margin: 0 auto;
    padding: 80px 40px;
  }

  .work-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 40px;
    align-items: start;
  }

  .project-card {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: inherit;
    transition: opacity 0.2s;
  }

  .project-card:hover {
    opacity: 0.8;
  }

  .project-card-image {
    width: 100%;
    aspect-ratio: 16 / 9;
    margin-bottom: 20px;
    border-radius: 4px;
    overflow: hidden;
  }

  .project-card-image .placeholder-image {
    width: 100%;
    height: 100%;
  }

  .project-card-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .project-card-company {
    font-size: var(--step--1);
    color: var(--muted);
    font-family: 'Inter', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 4px;
  }

  .project-card-title {
    font-size: var(--step-2);
    font-weight: 500;
    font-family: 'Inter', sans-serif;
    color: var(--text);
    margin: 0;
    line-height: 1.3;
  }

  .project-card-description {
    font-size: var(--step-0);
    line-height: 1.6;
    color: var(--text);
    margin: 8px 0 0;
  }

  .project-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--hairline-subtle);
  }

  .project-tag {
    font-size: var(--step--1);
    color: var(--muted);
    font-family: 'Inter', sans-serif;
  }

  /* Mobile responsive */
  @media (max-width: 767px) {
    .work-page {
      padding: 40px 20px;
    }

    .work-grid {
      grid-template-columns: 1fr;
      gap: 48px;
    }

    .project-card-title {
      font-size: var(--step-1);
    }
  }

  /* Tablet */
  @media (min-width: 768px) and (max-width: 1023px) {
    .work-page {
      padding: 60px 40px;
    }

    .work-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 32px;
    }
  }
</style>
