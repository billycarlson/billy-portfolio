---
import TopNav from "../components/TopNav.astro";

// Load stories
const storyModules = import.meta.glob('../content/stories/*.mdx');
const allStories = await Promise.all(
  Object.entries(storyModules).map(async ([path, module]) => {
    try {
      const story = await module();
      const filename = path.split('/').pop() || '';
      const slug = filename.replace(/\.mdx$/, '');
      return {
        slug,
        title: story.frontmatter?.title || 'Untitled',
        lede: story.frontmatter?.lede || '',
        meta: story.frontmatter?.meta || []
      };
    } catch (error) {
      console.error(`Error loading story from ${path}:`, error);
      return null;
    }
  })
);

// Load case studies
const caseStudyModules = import.meta.glob('../content/case-studies/*.mdx');
const allCaseStudies = await Promise.all(
  Object.entries(caseStudyModules).map(async ([path, module]) => {
    try {
      const caseStudy = await module();
      const filename = path.split('/').pop() || '';
      const slug = filename.replace(/\.mdx$/, '');
      return {
        slug,
        title: caseStudy.frontmatter?.title || 'Untitled',
        lede: caseStudy.frontmatter?.lede || '',
        meta: caseStudy.frontmatter?.meta || []
      };
    } catch (error) {
      console.error(`Error loading case study from ${path}:`, error);
      return null;
    }
  })
);

// Filter out nulls and templates
const stories = allStories.filter(story => story !== null && story.slug !== 'case-study-template');
const caseStudies = allCaseStudies.filter(cs => cs !== null && cs.slug !== 'case-study-template');
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Billy Carlson - Product Design Director</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
		<link rel="stylesheet" href="/styles/case-study.css" />
	</head>
	<body>
		<TopNav />
		
		<main class="stories-page">
			<div class="stories-intro">
				<p class="stories-intro-text">
					I am a product design leader who is driven to create designs that fulfill both user and business objectives.
				</p>
			</div>

			{caseStudies.length > 0 && (
				<section class="content-section">
					<h2 class="section-title">Case Studies</h2>
					<div class="stories-grid">
						{caseStudies.map((caseStudy) => (
							<article class="story-card">
								<h3 class="story-title">
									<a href={`/case-studies/${caseStudy.slug}`}>{caseStudy.title}</a>
								</h3>
								{caseStudy.lede && (
									<p class="story-lede">{caseStudy.lede}</p>
								)}
								{caseStudy.meta.length > 0 && (
									<div class="story-meta">
										{caseStudy.meta.map((m) => <span>{m}</span>)}
									</div>
								)}
							</article>
						))}
					</div>
				</section>
			)}

			{stories.length > 0 && (
				<section class="content-section">
					<h2 class="section-title">Stories</h2>
					<div class="stories-grid">
						{stories.map((story) => (
							<article class="story-card">
								<h3 class="story-title">
									<a href={`/stories/${story.slug}`}>{story.title}</a>
								</h3>
								{story.lede && (
									<p class="story-lede">{story.lede}</p>
								)}
								{story.meta.length > 0 && (
									<div class="story-meta">
										{story.meta.map((m) => <span>{m}</span>)}
									</div>
								)}
							</article>
						))}
					</div>
				</section>
			)}
		</main>
	</body>
</html>

<style>
  .stories-page {
    max-width: 1320px;
    margin: 0 auto;
    padding: 80px var(--page-pad-right) 80px var(--page-pad-left);
    width: 100%;
  }

  .section-title {
    font-size: var(--step-3); /* 30px */
    line-height: 1.15;
    color: var(--text);
    font-weight: 500;
    font-family: 'Inter', sans-serif;
    margin: 0 0 40px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--hairline);
  }

  .content-section {
    margin-bottom: 80px;
  }

  .content-section:last-child {
    margin-bottom: 0;
  }

  .stories-intro {
    margin-bottom: 60px;
    max-width: 600px;
  }

  .stories-intro-text {
    font-size: var(--step-4); /* 40px */
    line-height: 1.15;
    color: var(--text);
    font-weight: 400;
    font-family: 'Inter', sans-serif;
    margin: 0;
  }

  .stories-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 60px;
  }

  .story-card {
    padding-bottom: 40px;
    border-bottom: 1px solid var(--hairline-subtle);
  }

  .story-card:last-child {
    border-bottom: none;
  }

  .story-title {
    font-size: var(--step-2); /* 22px */
    line-height: 1.15;
    margin: 0 0 12px;
    font-weight: 500;
    font-family: 'Inter', sans-serif;
  }

  .story-title a {
    text-decoration: none;
    color: var(--text);
    transition: color 0.2s;
  }

  .story-title a:hover {
    color: var(--muted-light);
  }

  .story-lede {
    font-size: var(--step-0); /* 16px */
    color: var(--muted);
    margin: 0 0 12px;
    line-height: 1.6;
  }

  .story-meta {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    color: var(--muted);
    font-size: var(--step--1);
  }

  @media (max-width: 767px) {
    .stories-page {
      padding: 40px 20px;
    }

    .section-title {
      font-size: var(--step-2);
      margin-bottom: 30px;
    }

    .content-section {
      margin-bottom: 60px;
    }

    .stories-intro {
      margin-bottom: 40px;
    }

    .stories-intro-text {
      font-size: var(--step-2);
    }

    .stories-grid {
      gap: 40px;
    }

    .story-card {
      padding-bottom: 30px;
    }
  }

  @media (min-width: 768px) and (max-width: 1023px) {
    .stories-page {
      padding: 60px 40px;
    }
  }

</style>

