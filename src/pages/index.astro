---
import TopNav from "../components/TopNav.astro";
import Footer from "../components/Footer.astro";

// Load stories
const storyModules = import.meta.glob('../content/stories/*.mdx');
const allStories = await Promise.all(
  Object.entries(storyModules).map(async ([path, module]) => {
    try {
      const story = await module();
      const filename = path.split('/').pop() || '';
      const slug = filename.replace(/\.mdx$/, '');
      return {
        slug,
        title: story.frontmatter?.title || 'Untitled',
        lede: story.frontmatter?.lede || '',
        meta: story.frontmatter?.meta || []
      };
    } catch (error) {
      console.error(`Error loading story from ${path}:`, error);
      return null;
    }
  })
);

// Load case studies
const caseStudyModules = import.meta.glob('../content/case-studies/*.mdx');
const allCaseStudies = await Promise.all(
  Object.entries(caseStudyModules).map(async ([path, module]) => {
    try {
      const caseStudy = await module();
      const filename = path.split('/').pop() || '';
      const slug = filename.replace(/\.mdx$/, '');
      return {
        slug,
        title: caseStudy.frontmatter?.title || 'Untitled',
        lede: caseStudy.frontmatter?.lede || '',
        meta: caseStudy.frontmatter?.meta || []
      };
    } catch (error) {
      console.error(`Error loading case study from ${path}:`, error);
      return null;
    }
  })
);

// Filter out nulls and templates
const stories = allStories.filter(story => story !== null && story.slug !== 'case-study-template');
const caseStudies = allCaseStudies.filter(cs => cs !== null && cs.slug !== 'case-study-template');
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Billy Carlson - Product Design Director</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
		<link rel="stylesheet" href="/styles/case-study.css" />
	</head>
	<body>
		<TopNav />
		
		<main class="stories-page">
			<!-- WHO I AM section -->
			<section class="one-col-section" style="max-width: 800px; margin: 0 auto;">
					<p class="section-intro">
						<b>I’m a design leader who excels at bringing people together.</b> I create environments where teams <i>feel aligned, supported, and confident</i> in the work they’re doing. I <i>communicate clearly</i> across design, product, and engineering, explaining not just what we’re building, but why it matters.
					</p>
							</section>

			<!-- CASE STUDIES section -->
			{caseStudies.length > 0 && (
				<section class="two-col-section">
					<div class="col-left">
						<h2 class="section-label">Case Studies</h2>
					</div>
					<div class="col-right">
						{caseStudies.map((caseStudy) => (
							<article class="work-card stacked">
								<div class="work-card-image">
									<div class="placeholder-image"></div>
								</div>
								<div class="work-card-content">
									<h3 class="work-card-title">
										<a href={`/case-studies/${caseStudy.slug}`}>{caseStudy.title}</a>
									</h3>
									{caseStudy.lede && (
										<p class="work-card-lede">{caseStudy.lede}</p>
									)}
									{caseStudy.meta.length > 0 && (
										<div class="work-card-meta">
											{caseStudy.meta.map((m) => <span>{m}</span>)}
										</div>
									)}
								</div>
							</article>
						))}
					</div>
				</section>
			)}

			<!-- STORIES section -->
			{stories.length > 0 && (
				<section class="two-col-section">
					<div class="col-left">
						<h2 class="section-label">Stories</h2>
					</div>
					<div class="col-right">
						{stories.map((story) => (
							<article class="work-card">
								<div class="work-card-image">
									<div class="placeholder-image"></div>
								</div>
								<div class="work-card-content">
									<h3 class="work-card-title">
										<a href={`/stories/${story.slug}`}>{story.title}</a>
									</h3>
									{story.lede && (
										<p class="work-card-lede">{story.lede}</p>
									)}
									{story.meta.length > 0 && (
										<div class="work-card-meta">
											{story.meta.map((m) => <span>{m}</span>)}
										</div>
									)}
								</div>
							</article>
						))}
					</div>
				</section>
			)}

			<!-- Bottom section -->
			<section class="bottom-section">
				<p class="bottom-text">
					Design leadership isn't about having all the answers—it's about creating the conditions where great work can happen. Over the past fifteen years, I've learned that the best products come from teams that feel empowered to take risks, challenge assumptions, and push beyond the obvious solution. My role is to build those teams, protect their focus, and help them navigate the inevitable tensions between business goals and user needs.
				</p>
			</section>
		</main>

		<Footer />
	</body>
</html>

<style>
  /* Page-specific styles for index */
  .stories-page {
    max-width: 1320px;
    margin: 0 auto;
    padding: 80px 80px;
    width: 100%;
  }

  .section-intro {
    font-size: var(--step-4);
    line-height: 1.15;
    color: var(--text);
    font-weight: 400;
    font-family: 'Inter', sans-serif;
    margin: 0;
    width: fit-content;
  }

  /* Attribute items (Who I Am section) */
  .attribute-item {
    padding-top: 28px;
    padding-bottom: 28px;
    border-top: 1px solid var(--hairline);
  }

  .attribute-item:first-child {
    border-top: none;
    padding-top: 0;
  }

  .attribute-title {
    font-size: var(--step-2);
    font-weight: 500;
    font-family: 'Inter', sans-serif;
    color: var(--text);
    margin: 0 0 16px;
  }

  .attribute-text {
    font-size: var(--step-0);
    line-height: 1.6;
    color: var(--text);
    margin: 0;
    width: 100%;
  }

  /* Mobile responsive - page specific */
  @media (max-width: 767px) {
    .stories-page {
      padding: 40px 16px;
      overflow-x: hidden;
    }

    .section-intro {
      font-size: var(--step-2);
    }

    .attribute-text {
      max-width: 100%;
    }
  }

  /* Tablet - page specific */
  @media (min-width: 768px) and (max-width: 1023px) {
    .stories-page {
      padding: 60px 40px;
    }
  }
</style>

